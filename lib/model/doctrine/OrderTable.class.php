<?php

/**
 * OrderTable
 * This class has been auto-generated by the Doctrine ORM Framework
 */
class OrderTable extends Doctrine_Table
{

    public static $states = [
        "calculating" => "На просчёте",

        "prepress" => "Необходим дизайн (препресс)",
        "prepress-working" => "Дизайн (препресс) в работе",
        "prepress-done" => "Дизайн (препресс) готов",

        "work" => "В цех",
        "working" => "В работе",
        self::STATE_DONE => "Всё готово",

        self::STATE_SUBMITTED => "Сдан",

        "archived" => "В архиве",
        "debt" => "Дебиторка",

        "deleted" => "Удалён",
    ];

    const STATE_DONE = 'done';
    const STATE_SUBMITTED = 'submited';

    public static function getSetableStates()
    {
        $user = sfContext::getInstance()->getUser();

        $statesForManager = [
            "calculating",
            "prepress",
            "work",
        ];

        $statesForDesignWorker = [
            "prepress",
            "prepress-working",
            "prepress-done",
        ];
        $statesForDesignMaster = [
            "prepress-working",
            "prepress-done",
        ];

        $statesForWorker = [
            "work",
            "working",
            self::STATE_DONE,
            self::STATE_SUBMITTED,
        ];
        $statesForMaster = [
            "working",
            self::STATE_DONE,
        ];

        $statesForBuhgalter = [
            "archived",
            "debt",
        ];

        $statesForMonitor = [
            "work",
            "working",
            self::STATE_DONE,
        ];

        return array_unique(array_merge(
            []
            , $user->hasCredential("manager") ? $statesForManager : []

            , $user->hasCredential("worker") ? $statesForWorker : []
            , $user->hasCredential("master") ? $statesForMaster : []

            , $user->hasCredential("design-worker") ? $statesForDesignWorker : []
            , $user->hasCredential("design-master") ? $statesForDesignMaster : []

            , $user->hasCredential("buhgalter") ? $statesForBuhgalter : []

            , $user->hasCredential("monitor") ? $statesForMonitor : []
            , $user->hasCredential("can-delete-orders") ? ["deleted"] : []
        ));
    }

    public static function getSetableStatesWithNames()
    {
        return array_intersect_key(self::$states, array_flip(self::getSetableStates()));
    }

    public static $payMethods = [
        "" => "",
        "cash" => "Наличный",
        "non-cash" => "Безналичный",
        "barter" => "Бартер",
        "settlement" => "Взаиморасчёт",
    ];

    public static $area = [
        "" => "",
        "pvc" => "PVC",
        "laser" => "ЛАЗЕР",
        "engraver" => "ГРАВЕР",
        "mymaka" => "МИМАКА",
        "outdoor" => "НАРУЖНАЯ РЕКЛАМА",
        "lfp" => "ПЕЧАТЬ ШФП",
        "sublimation" => "СУБЛИМАЦИЯ",
        "cutter" => "ФРЕЗЕР",
        "serigraphy" => "ШЕЛКОГРАФИЯ",
    ];

    /**
     * Returns an instance of this class.
     *
     * @return object OrderTable
     */
    public static function getInstance()
    {
        return Doctrine_Core::getTable("Order");
    }
}
